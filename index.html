<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TR√ÄN B·ªò NH·ªö - Game Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CSS GI·ªÆ NGUY√äN NH∆Ø C≈® --- */
        :root {
            --bg-gradient-1: #87CEEB; 
            --bg-gradient-2: #E0F7FA; 
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-color: #2c3e50;
            --primary-color: #00a8ff;
            --primary-dark: #0984e3;
            --accent-yellow: #fbc531;
            --accent-pink: #ff7675;
            --nav-bg: rgba(255, 255, 255, 0.9); 
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --success-color: #2ecc71;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            color: var(--text-color);
            font-family: var(--font-main);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            background-color: #87CEEB;
            background: linear-gradient(180deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 100%);
        }

        /* --- NAVBAR STYLES --- */
        .navbar {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 30px;
            background: var(--nav-bg); 
            backdrop-filter: blur(10px); 
            position: sticky; 
            top: 0;
            z-index: 1000; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            border-bottom: 1px solid rgba(255,255,255,0.5);
        }

        .logo {
            font-size: 1.5rem; 
            font-weight: 900; 
            color: var(--primary-color); 
            text-transform: uppercase;
            letter-spacing: 1px; 
            text-decoration: none;
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
        .logo i { color: var(--accent-yellow); font-size: 1.8rem; }

        .nav-links { display: flex; gap: 25px; font-weight: 600; align-items: center; }
        .nav-links a { text-decoration: none; color: #555; transition: 0.3s; position: relative; font-size: 1rem; cursor: pointer; }
        .nav-links a:hover, .nav-links a.active { color: var(--primary-color); }
        .nav-links a::after {
            content: ''; position: absolute; width: 0; height: 3px; bottom: -5px; left: 0;
            background: var(--accent-yellow); transition: width 0.3s; border-radius: 2px;
        }
        .nav-links a:hover::after { width: 100%; }

        /* --- CSS DROPDOWN TH·ªÇ LO·∫†I --- */
        .dropdown { position: relative; display: flex; align-items: center; height: 100%; }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 220px;
            max-height: 400px; 
            overflow-y: auto; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1001;
            border-radius: 10px;
            padding: 10px 0;
            top: 100%; 
            left: 0;
            border: 1px solid rgba(0,0,0,0.05);
            margin-top: 10px; 
        }
        .dropdown-content::-webkit-scrollbar { width: 5px; }
        .dropdown-content::-webkit-scrollbar-thumb { background: #ccc; border-radius: 5px; }
        .dropdown-content::before {
            content: ""; position: absolute; top: -15px; left: 0; width: 100%; height: 20px; background: transparent;
        }
        .dropdown-content a {
            color: #333; padding: 12px 20px; text-decoration: none; display: block; font-size: 0.95rem; transition: 0.2s; border-bottom: 1px solid #f5f5f5;
        }
        .dropdown-content a:last-child { border-bottom: none; }
        .dropdown-content a:hover {
            background-color: var(--bg-gradient-2); color: var(--primary-color); padding-left: 25px; 
        }
        .dropdown:hover .dropdown-content { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .nav-actions { display: flex; align-items: center; gap: 15px; }
        
        .search-box {
            position: relative; background: #f1f2f6; border-radius: 30px; padding: 5px 15px;
            display: flex; align-items: center; border: 2px solid transparent; transition: 0.3s;
        }
        .search-box:focus-within { border-color: var(--primary-color); background: #fff; }
        .search-box input {
            border: none; background: transparent; outline: none; padding: 5px; width: 150px; color: #333; font-size: 0.9rem;
        }
        .search-box i { color: #aaa; }

        .icon-btn { font-size: 1.2rem; color: #555; cursor: pointer; position: relative; transition: 0.3s; }
        .icon-btn:hover { color: var(--primary-color); transform: scale(1.1); }
        
        .cart-badge {
            position: absolute; top: -8px; right: -8px; background: var(--accent-pink); color: white;
            font-size: 0.7rem; width: 18px; height: 18px; border-radius: 50%; display: flex; 
            justify-content: center; align-items: center; font-weight: bold;
        }

        .btn-login {
            background: var(--primary-color); color: white; border: none; padding: 8px 20px; 
            border-radius: 20px; font-weight: bold; cursor: pointer; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0, 168, 255, 0.3);
        }
        .btn-login:hover { background: var(--primary-dark); transform: translateY(-2px); }

        /* --- HERO SECTION --- */
        .hero { text-align: center; padding: 60px 20px 40px; }
        .hero h1 {
            font-size: 3rem; color: var(--primary-color); text-shadow: 3px 3px 0px #fff; margin-bottom: 10px;
        }
        .hero p { background: #fff; display: inline-block; padding: 5px 20px; border-radius: 20px; color: #666; font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        /* --- MAIN CONTAINER & GRID --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h2 { border-left: 8px solid var(--accent-yellow); padding-left: 20px; margin: 30px 0; text-transform: uppercase; color: var(--primary-color); font-weight: 800; }
        
        .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        
        .game-card {
            background: var(--card-bg); border-radius: 20px; overflow: hidden; transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(0, 168, 255, 0.15); position: relative;
            border: 2px solid transparent; display: flex; flex-direction: column;
        }
        .game-card:hover { transform: translateY(-10px); border-color: var(--accent-yellow); }
        
        .price-tag { position: absolute; top: 15px; right: 15px; background: var(--accent-pink); color: #fff; padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; z-index: 2; }
        .price-tag.free { background: var(--primary-color); }
        .price-tag.owned { background: var(--success-color); }
        
        .game-thumb { width: 100%; height: 180px; overflow: hidden; }
        .game-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.3s; }
        .game-card:hover .game-thumb img { transform: scale(1.05); }

        .game-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .game-title { font-size: 1.3rem; color: var(--primary-color); margin-bottom: 5px; font-weight: 700; }
        .game-desc { font-size: 0.9rem; color: #666; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .bank-info-display { background: #f0f9ff; padding: 10px; margin-top: 10px; border-radius: 8px; font-size: 0.85rem; color: #555; border-left: 3px solid var(--primary-color); display: none; margin-bottom: 10px;}
        .show-bank { display: block; }

        .card-actions { margin-top: auto; display: flex; gap: 10px; width: 100%; }
        
        .btn-play { 
            flex: 2; padding: 10px; background: var(--accent-yellow); color: #2c3e50; border: none; 
            border-radius: 30px; font-weight: 800; cursor: pointer; transition: 0.2s; box-shadow: 0 3px 0 #e1b12c; text-align: center;
        }
        .btn-play:hover { background: #fcd567; transform: translateY(-2px); }
        .btn-play:active { transform: translateY(2px); box-shadow: none; }

        .btn-secondary {
            flex: 1; padding: 10px; background: #fff; color: var(--primary-color); border: 2px solid var(--primary-color);
            border-radius: 30px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; text-align: center;
        }
        .btn-secondary:hover { background: var(--primary-color); color: white; }
        .btn-secondary.added { background: #ddd; color: #666; border-color: #ddd; cursor: not-allowed; }

        .btn-reset {
            background-color: #ff7675; color: white; border: none; padding: 10px 20px; border-radius: 30px;
            font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.3s;
        }
        .btn-reset:hover { background-color: #d63031; transform: translateY(-2px); }

        /* --- FORM UPLOAD (NEW) --- */
        .upload-section { background: #fff; padding: 40px; border-radius: 20px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .form-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .form-col { flex: 1; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: var(--primary-color); font-weight: 700; font-size: 1rem; }
        input, textarea, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; background: #f9f9f9; outline: none; transition: 0.3s; }
        input:focus, textarea:focus, select:focus { border-color: var(--primary-color); background: #fff; box-shadow: 0 0 5px rgba(0, 168, 255, 0.2); }
        .upload-header { text-align: center; margin-bottom: 30px; }
        .upload-header h1 { color: var(--primary-color); font-size: 2.5rem; }
        .required-mark { color: red; font-weight: bold; }

        /* --- FOOTER --- */
        footer { text-align: center; padding: 40px; margin-top: 60px; color: #fff; background: var(--primary-color); font-weight: bold; }

        /* --- DETAIL PAGE STYLES --- */
        .detail-header { text-align: left; padding-top: 20px; margin-bottom: 30px; }
        .detail-header h1 { font-size: 3rem; color: var(--text-color); text-shadow: none; margin-bottom: 5px; }
        .detail-header p { background: var(--card-bg); padding: 5px 10px; border-radius: 10px; color: #555; font-weight: 600; display: inline-block; }

        .detail-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; align-items: start; }
        .video-player { width: 100%; height: 450px; background: #000; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.2); position: relative; }
        .video-player iframe { width: 100%; height: 100%; border: none; }

        .game-specs { background: var(--card-bg); padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .game-specs h3 { color: var(--primary-dark); margin-bottom: 15px; border-bottom: 3px solid var(--accent-yellow); padding-bottom: 5px; }
        .spec-item { margin-bottom: 10px; font-size: 0.95rem; }
        .spec-item strong { color: var(--text-color); display: inline-block; width: 110px; }
        
        .story-section { margin-top: 30px; }
        .story-box { background: var(--card-bg); padding: 25px; border-radius: 15px; margin-top: 15px; color: #333; line-height: 1.6; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .gameplay-box { background: var(--card-bg); padding: 25px; border-radius: 15px; margin-top: 15px; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .win-loss-list { list-style: none; padding-left: 0; margin-top: 15px; }
        .win-loss-list li { margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px; }
        .purchase-note { background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; margin-top: 20px; border: 1px solid #ffeeba; display: flex; align-items: center; gap: 10px; }

        /* --- CSS CHO PH·∫¶N GI·ªöI THI·ªÜU --- */
        .intro-box { background: linear-gradient(to right, #ffffff, #f0f9ff); padding: 25px; border-radius: 15px; margin-top: 25px; border: 1px solid #e1e1e1; border-left: 6px solid var(--primary-color); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .intro-box h2 { border-left: none; padding-left: 0; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.5rem; }
        .intro-content { font-size: 1.1rem; color: #444; font-weight: 500; }
        .custom-list { margin-left: 20px; margin-bottom: 15px; }
        .custom-list li { margin-bottom: 5px; list-style-type: disc; }
        .content-paragraph { margin-bottom: 15px; }

        /* --- CSS CHO TRANG GI·ªé H√ÄNG (CART PAGE) --- */
        .cart-section { margin-top: 20px; }
        .cart-table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .cart-table th, .cart-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .cart-table th { background: var(--primary-color); color: white; }
        .cart-item-img { width: 80px; height: 50px; object-fit: cover; border-radius: 5px; }
        .cart-total { text-align: right; margin-top: 20px; font-size: 1.5rem; font-weight: bold; color: var(--text-color); }
        .btn-remove { color: var(--accent-pink); background: none; border: none; cursor: pointer; font-size: 1.2rem; }
        .btn-remove:hover { color: #d63031; }
        .btn-checkout { display: block; width: 100%; max-width: 300px; margin: 30px 0 0 auto; background: var(--success-color); color: white; font-size: 1.2rem; padding: 15px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); transition: 0.3s; }
        .btn-checkout:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(46, 204, 113, 0.6); }
        .empty-cart-msg { text-align: center; padding: 50px; background: rgba(255,255,255,0.8); border-radius: 15px; }
        .owned-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .owned-item { background: #fff; padding: 10px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-bottom: 3px solid var(--success-color); }

        /* --- RESPONSIVE --- */
        @media (max-width: 900px) { .detail-grid { grid-template-columns: 1fr; } .video-player { height: 300px; } }
        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 15px; padding: 15px; }
            .nav-links { gap: 15px; font-size: 0.9rem; width: 100%; justify-content: center; }
            .nav-actions { width: 100%; justify-content: space-between; }
            .search-box input { width: 100%; }
            .form-row { flex-direction: column; gap: 0; }
        }
    </style>
</head>
<body>

    <div id="app-container">
    </div>

    <footer>
        <p>&copy; 2025 Nh√≥m TR√ÄN B·ªò NH·ªö.</p>
    </footer>

    <script>
        // --- 1. D·ªÆ LI·ªÜU GAME (DATABASE) ƒê√É C·∫¨P NH·∫¨T LINK T·∫¢I ---
        const initialGames = [
            { 
                id: 1, 
                name: "Magician vs. Goblin", 
                desc: "ƒê·∫°i chi·∫øn ·∫£o thu·∫≠t gia v√† qu√°i v·∫≠t Goblin. Game nh·∫≠p vai h√†nh ƒë·ªông.", 
                intro: `B·∫°n c√≥ th·ªÉ s·ªëng s√≥t kh·ªèi b·∫ßy Goblin kh√¥ng?
                
                Magician vs Goblin l√† game h√†nh ƒë·ªông s·ªëng c√≤n nh·ªãp ƒë·ªô nhanh, n∆°i b·∫°n v√†o vai m·ªôt Ph√°p S∆∞ tr·∫ª b·ªã bao v√¢y b·ªüi l≈© Goblin hung h√£n. B·∫°n ch·ªâ c√≥ m·ªôt m√¨nh ‚Äî nh∆∞ng s·ªü h·ªØu ma thu·∫≠t m·∫°nh m·∫Ω. M·ªói gi√¢y l√† m·ªôt tr·∫≠n chi·∫øn sinh t·ªìn khi b·∫°n ph·∫£i v·ª´a n√©, v·ª´a b·∫Øn ph√©p, v·ª´a c·ªë g·∫Øng duy tr√¨ m·∫°ng s·ªëng gi·ªØa s·ªë l∆∞·ª£ng Goblin tƒÉng d·∫ßn theo th·ªùi gian.`,
                price: 50000, 
                bankInfo: "999999 - Techcombank - VO MINH TRIET", 
                img: "GameImage/game1.png", 
                genre: "2D Action, Top-down Shooter, Survival Combat", 
                players: "Single", 
                developer: "V√µ Minh Tri·∫øt", 
                release: "07/11/2025", 
                videoUrl: "https://www.youtube.com/embed/kS1iZw9P5O0",
                downloadUrl: "https://vominhtriet.itch.io/blackmagician-vs-goblin", // LINK GAME 1
                story: `√ù t∆∞·ªüng c·ªët l√µi:
                + Ti√™u di·ªát c√†ng nhi·ªÅu Goblin c√†ng t·ªët.
                + S·ªëng c√†ng l√¢u c√†ng t·ªët.
                + C∆° ch·∫ø ch∆°i nhanh, tr·ª±c quan.

                C·ªët truy·ªán:
                B·∫°n l√† m·ªôt Ph√°p S∆∞ h·ªçc vi·ªác ƒëang th·ª±c t·∫≠p t·∫°i v√πng r·ª´ng ma thu·∫≠t. C√°nh c·ªïng qu√°i v·∫≠t m·ªü ra, nhi·ªám v·ª• c·ªßa b·∫°n l√† c·∫ßm c·ª± ch·ªù vi·ªán binh!`,
                gameplay: `Di chuy·ªÉn: n√∫t di chuy·ªÉn ho·∫∑c chu·ªôt 
                Ng·∫Øm: theo h∆∞·ªõng chu·ªôt.
                B·∫Øn ph√©p: Nh·∫•n/gi·ªØ chu·ªôt tr√°i ‚Üí b·∫Øn Spell.`,
                winCondition: `S·ªëng c√†ng l√¢u c√†ng t·ªët.`,
                lossCondition: "HP = 0."
            },
            { 
                id: 2, 
                name: "Sinh Vi√™n sinh t·ªìn", 
                desc: "S·ªëng s√≥t qua 30 ng√†y c√πng nh·ªØng bi·∫øn c·ªë b·∫•t ng·ªù th·ªùi Sinh vi√™n.", 
                intro: `Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi chi·∫øn tr∆∞·ªùng kh·ªëc li·ªát nh·∫•t: ƒê·∫°i H·ªçc! Kh√¥ng c√≥ s√∫ng ƒë·∫°n, k·∫ª th√π c·ªßa b·∫°n l√† 'Deadline', 'M√¨ t√¥m' v√† 'H·∫øt ti·ªÅn'.
                B·∫°n c√≥ th·ªÉ TR·ª§ t·ªõi ng√†y cu·ªëi c√πng ƒë∆∞·ª£c kh√¥ng?`,
                price: 0, 
                bankInfo: "", 
                img: "GameImage/game2.png", 
                genre: "2D Simulator, Resource management", 
                players: "Single", 
                developer: "V√µ Ng·ªçc B·∫£o Tr√¢n", 
                release: "08/11/2025", 
                videoUrl: "https://www.youtube.com/embed/7rkcFUS7tNI",
                downloadUrl: "https://barotrun.itch.io/sinhvien-sinhton", // LINK GAME 2
                story: `M√¥ ph·ªèng cu·ªôc chi·∫øn sinh t·ªìn ƒë√¥ th·ªã c·ªßa sinh vi√™n nƒÉm nh·∫•t.
                M·ª•c ti√™u: ƒê·∫°t ƒë·∫øn Ng√†y 30 m√† kh√¥ng ƒë·ªÉ ch·ªâ s·ªë Ti·ªÅn, S·ª©c kh·ªèe, ƒê·ªô no <=0 ho·∫∑c Stress >=100.`,
                gameplay: "Game theo l∆∞·ª£t (Turn-based). D√πng chu·ªôt l·ª±a ch·ªçn quy·∫øt ƒë·ªãnh cho c√°c s·ª± ki·ªán h√†ng ng√†y.",
                winCondition: "S·ªëng s√≥t qua 30 ng√†y.",
                lossCondition: `Ti·ªÅn <= 0, S·ª©c kh·ªèe <= 0, ƒê·ªô no <= 0, ho·∫∑c Stress >= 100.`
            },
            { 
                id: 3, 
                name: "Anya's Neo Dodger", 
                desc: "N√© tr√°nh b√†i t·∫≠p Vi T√≠ch Ph√¢n trong th·∫ø gi·ªõi Cyberpunk c√πng ANYA.", 
                intro: "Sinh t·ªìn qua c∆°n √°c m·ªông Vi T√≠ch Ph√¢n trong th·∫ø gi·ªõi Retro-Cyberpunk c√πng ANYA!",
                price: 0, 
                bankInfo: "", 
                img: "GameImage/game3.png", 
                genre: "Arcade Survival, Endless, 8-bit", 
                players: "Single", 
                developer: "Nguy·ªÖn L√™ Ch√≠ T∆∞·ªùng", 
                release: "09/11/2025", 
                videoUrl: "https://www.youtube.com/embed/xqmehhKTZZI",
                downloadUrl: "https://chituong217.itch.io/anyas-neo-dodger", // LINK GAME 3
                story: `Anya b·ªã chuy·ªÉn sinh v√†o th·∫ø gi·ªõi th·ª±c t·∫°i HCMUS. M·ªói ƒë√™m c√¥ ph·∫£i n√© tr√°nh nh·ªØng cu·ªën s√°ch Vi T√≠ch Ph√¢n r∆°i xu·ªëng trong gi·∫•c m∆° Cyberpunk.`,
                gameplay: "D√πng Ph√≠m M≈©i T√™n Tr√°i/Ph·∫£i ƒë·ªÉ di chuy·ªÉn Anya n√© tr√°nh.",
                winCondition: "S·ªëng s√≥t c√†ng l√¢u c√†ng t·ªët.",
                lossCondition: "Va ch·∫°m 3 l·∫ßn v·ªõi s√°ch Vi T√≠ch Ph√¢n."
            },
            { 
                id: 4, 
                name: "ERROR RUN", 
                desc: "Ch·∫°y tr·ªën m√†n h√¨nh xanh ch·∫øt ch√≥c g·ªìm BUG v√† ERROR.", 
                intro: `H√ÉY TR√ÅNH N√â T·∫§T C·∫¢ C√ÅC BUG - ERROR ƒê·ªÇ MANG V·ªÄ ƒêI·ªÇM S·ªê CAO NH·∫§T CHO M√îN C∆† S·ªû L·∫¨P TR√åNH C·ª¶A B·∫†N !!!`,
                price: 20000, 
                bankInfo: "777777 - ACB - VO NGUYEN CONG TRI", 
                img: "GameImage/game4.png", 
                genre: "Endless Runner, Arcade", 
                players: "Single", 
                developer: "V√µ Nguy·ªÖn C√¥ng Tr√≠", 
                release: "10/11/2025", 
                videoUrl: "https://www.youtube.com/embed/6AuqZ9ZINVQ",
                downloadUrl: "https://chituong217.itch.io/anyas-neo-dodger", // LINK GAME 4 (L∆∞u √Ω: Link b·∫°n g·ª≠i tr√πng v·ªõi game 3, h√£y thay link ƒë√∫ng n·∫øu c√≥)
                story: `Sinh vi√™n Tr√≠ b·ªã h√∫t v√†o th·∫ø gi·ªõi m√£ l·ªánh. Ph·∫£i li√™n t·ª•c bay qua c√°c khe h·ªü bug ƒë·ªÉ commit code k·ªãp deadline.`,
                gameplay: `PC: Spacebar/Chu·ªôt tr√°i. Mobile: Ch·∫°m m√†n h√¨nh.`,
                winCondition: `S·ªëng c√†ng l√¢u c√†ng t·ªët, ghi ƒëi·ªÉm cao.`,
                lossCondition: `Va ch·∫°m v√†o c·ªôt l·ªói, tr·∫ßn ho·∫∑c s√†n nh√†.`
            },
            { 
                id: 5, 
                name: "Naruto Adventure", 
                desc: "Nhi·ªám v·ª• Ninja c·∫•p S c√πng Kakashi(?) v√† Naruto.", 
                intro: `Game h√†nh ƒë·ªông platformer 2D. Ch·ªçn Naruto ho·∫∑c Kakashi ƒë·ªÉ b·∫£o v·ªá L√†ng L√° kh·ªèi Sound Ninja.`,
                price: 0, 
                bankInfo: "", 
                img: "GameImage/game5.png", 
                genre: "Adventure, Fighting", 
                players: "Single", 
                developer: "ƒê·ªó Duy Tr∆∞·ªùng", 
                release: "11/11/2025", 
                videoUrl: "https://www.youtube.com/embed/4XScOKO0Y40",
                downloadUrl: "https://truonghhaz.itch.io/naruto-adventure", // LINK GAME 5
                story: `B·∫£o v·ªá L√†ng L√° kh·ªèi Ninja L√†ng √Çm Thanh. Kakashi thi√™n v·ªÅ chi·∫øn thu·∫≠t, Naruto thi√™n v·ªÅ t·∫•n c√¥ng di·ªán r·ªông.`,
                gameplay: `Di chuy·ªÉn: M≈©i t√™n/WASD. T·∫•n c√¥ng: J, K. Tuy·ªát k·ªπ: L, U.`,
                winCondition: `Ti√™u di·ªát h·∫øt ƒë·ªãch ƒë·ªÉ qua m√†n.`,
                lossCondition: `M√°u v·ªÅ 0 ho·∫∑c r∆°i xu·ªëng v·ª±c.`
            },
            { 
                id: 6, 
                name: "D·∫°o Ph·ªë CHILL", 
                desc: "L√°i xe th∆∞ gi√£n c√πng nh·∫°c Lofi trong th·∫ø gi·ªõi si√™u th·ª±c.", 
                intro: `G√°c l·∫°i √¢u lo, b·∫≠t nh·∫°c l√™n v√† t·∫≠n h∆∞·ªüng. Ch·ªâ c√≥ b·∫°n v√† chi·∫øc xe l∆∞·ªõt ƒëi trong m√†n ƒë√™m.`,
                price: 100000, 
                bankInfo: "111111 - Vietcombank - DOAN HOANG VIET", 
                img: "GameImage/game6.png", 
                genre: "Simulation / Hangout", 
                players: "Single", 
                developer: "ƒêo√†n Ho√†ng Vi·ªát", 
                release: "12/10/2025", 
                videoUrl: "https://www.youtube.com/embed/jNlELPjMwOQ",
                downloadUrl: "https://www.roblox.com/games/13217277322/Dao-Pho-Chill", // LINK GAME 6 (ƒê√£ ch·ªânh l·∫°i link Roblox chu·∫©n ƒë·ªÉ m·ªü web)
                story: `M·ªôt th·∫ø gi·ªõi m·ªü ƒë·ªÉ chill, l√°i xe ng·∫Øm c·∫£nh v√† nghe nh·∫°c. Kh√¥ng √°p l·ª±c, kh√¥ng k·∫ª th√π.`,
                gameplay: `Di chuy·ªÉn: WASD. Chu·ªôt: Xoay camera. M: Menu ƒëi·ªán tho·∫°i.`,
                winCondition: "Kh√¥ng c√≥, game ch·ªâ ƒë·ªÉ th∆∞ gi√£n.",
                lossCondition: "Khi t·∫Øt game."
            }
        ];

        // --- H√ÄM L·∫§Y D·ªÆ LI·ªÜU T·ª™ LOCAL STORAGE (L∆ØU TR·ªÆ Vƒ®NH VI·ªÑN) ---
        function getStoredGames() {
            const stored = localStorage.getItem('myCustomGames');
            return stored ? JSON.parse(stored) : [];
        }

        // --- H√ÄM L∆ØU GAME M·ªöI V√ÄO LOCAL STORAGE ---
        function saveCustomGame(newGame) {
            const currentStored = getStoredGames();
            currentStored.push(newGame);
            localStorage.setItem('myCustomGames', JSON.stringify(currentStored));
        }

        // K·∫øt h·ª£p game g·ªëc + game ƒë√£ l∆∞u t·ª´ b·ªô nh·ªõ
        let currentGames = [...initialGames, ...getStoredGames()];
        
        const appContainer = document.getElementById('app-container');
        const formatter = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' });

        // --- 2. H·ªÜ TH·ªêNG QU·∫¢N L√ù GI·ªé H√ÄNG (STORAGE) ---
        function getCart() { return JSON.parse(localStorage.getItem('cart') || '[]'); }
        function saveCart(cart) { localStorage.setItem('cart', JSON.stringify(cart)); updateCartBadge(); }
        
        function addToCart(gameId) {
            let cart = getCart();
            let library = getLibrary();
            if (library.includes(gameId)) { alert("B·∫°n ƒë√£ s·ªü h·ªØu game n√†y r·ªìi!"); return; }
            if (!cart.includes(gameId)) {
                cart.push(gameId);
                saveCart(cart);
                alert("ƒê√£ th√™m v√†o gi·ªè h√†ng!");
            } else {
                alert("Game n√†y ƒë√£ c√≥ trong gi·ªè h√†ng!");
            }
            if (!getQueryParam('view') && !getQueryParam('game')) {
                const gameGrid = document.getElementById('gameGrid');
                if (gameGrid) renderGames(currentGames, gameGrid);
            }
        }
        
        function removeFromCart(gameId) {
            let cart = getCart();
            cart = cart.filter(id => id !== gameId);
            saveCart(cart);
            renderCartPage();
        }
        
        function getLibrary() { return JSON.parse(localStorage.getItem('library') || '[]'); }
        function saveLibrary(library) { localStorage.setItem('library', JSON.stringify(library)); }

        // --- H√ÄM RESET D·ªÆ LI·ªÜU ---
        function resetLibrary() {
            if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën X√ìA TO√ÄN B·ªò d·ªØ li·ªáu (Game ƒë√£ mua + Game ƒë√£ ƒëƒÉng)?")) {
                localStorage.removeItem('library');
                localStorage.removeItem('cart');
                localStorage.removeItem('myCustomGames'); // X√≥a c·∫£ game ƒë√£ ƒëƒÉng
                alert("ƒê√£ reset d·ªØ li·ªáu! V·ªÅ trang ch·ªß...");
                window.location.href = window.location.pathname; 
            }
        }

        function updateCartBadge() {
            const badge = document.querySelector('.cart-badge');
            if (badge) {
                const count = getCart().length;
                badge.textContent = count;
                badge.style.display = count > 0 ? 'flex' : 'none';
            }
        }

        // --- H√ÄM THANH TO√ÅN ---
        function processCheckout() {
            const cart = getCart();
            if (cart.length === 0) {
                alert("Gi·ªè h√†ng ƒëang tr·ªëng! H√£y th√™m game v√†o tr∆∞·ªõc khi thanh to√°n.");
                return;
            }

            // T√≠nh t·ªïng ti·ªÅn ƒë·ªÉ hi·ªÉn th·ªã trong confirm
            const allGames = [...initialGames, ...getStoredGames()];
            const cartItemsFull = allGames.filter(g => cart.includes(g.id));
            const total = cartItemsFull.reduce((sum, item) => sum + item.price, 0);
            const totalFormatted = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(total);

            if (confirm(`X√°c nh·∫≠n thanh to√°n ${cart.length} game?\nT·ªïng c·ªông: ${totalFormatted}`)) {
                let library = getLibrary();
                
                // Th√™m game v√†o th∆∞ vi·ªán
                cart.forEach(id => {
                    if (!library.includes(id)) library.push(id);
                });
                
                saveLibrary(library); // L∆∞u th∆∞ vi·ªán m·ªõi
                saveCart([]);         // X√≥a s·∫°ch gi·ªè h√†ng
                
                alert("Thanh to√°n th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô TBN Studio.");
                renderCartPage();     // Load l·∫°i trang ƒë·ªÉ th·∫•y game ƒë√£ mua
                updateCartBadge();    // Reset s·ªë tr√™n icon gi·ªè h√†ng
            }
        }

        // --- 3. HELPER FUNCTIONS (FORMAT TEXT) ---
        function formatGameText(text) {
            if (!text) return "";

            let formatted = text
                .replace(/√ù t∆∞·ªüng c·ªët l√µi/g, "<strong>√ù t∆∞·ªüng c·ªët l√µi</strong>")
                .replace(/√ù t∆∞·ªüng trung t√¢m/g, "<strong>√ù t∆∞·ªüng trung t√¢m</strong>")
                .replace(/√ù t∆∞·ªüng:/g, "<strong>√ù t∆∞·ªüng:</strong>")
                .replace(/C·ªët truy·ªán:/g, "<strong>C·ªët truy·ªán:</strong>")
                .replace(/C·ªët truy·ªán(?![^<]*>)/g, "<strong>C·ªët truy·ªán</strong>"); 

            const paragraphs = formatted.split(/\n\s*\n/);
            let html = '';
            
            paragraphs.forEach(para => {
                if (para.trim().includes('+')) {
                    const lines = para.split('\n');
                    let inList = false;
                    
                    lines.forEach(line => {
                        let cleanLine = line.trim();
                        if (cleanLine.startsWith('+')) {
                            if (!inList) { html += '<ul class="custom-list">'; inList = true; }
                            html += `<li>${cleanLine.substring(1).trim()}</li>`;
                        } else {
                            if (inList) { html += '</ul>'; inList = false; }
                            if (cleanLine.length > 0) { html += `<div class="content-paragraph">${line}</div>`; }
                        }
                    });
                    if (inList) html += '</ul>';
                } else {
                    if (para.trim().length > 0) {
                        html += `<div class="content-paragraph">${para.replace(/\n/g, '<br>')}</div>`;
                    }
                }
            });
            return html;
        }

        // --- 4. C√ÅC H√ÄM X·ª¨ L√ù MENU DROPDOWN & L·ªåC GENRE ---
        function getAllGenres() {
            let allGenres = [];
            currentGames.forEach(game => { // D√πng currentGames ƒë·ªÉ l·∫•y c·∫£ genre c·ªßa game m·ªõi
                let genres = game.genre.split(/[,\/]/).map(g => g.trim());
                allGenres.push(...genres);
            });
            return [...new Set(allGenres)].sort();
        }

        function renderGenreDropdown() {
            const dropdown = document.getElementById('genreDropdown');
            if (!dropdown) return;
            const genres = getAllGenres();
            let html = `<a href="#" onclick="filterByGenre('')">‚≠ê T·∫•t c·∫£</a>`;
            genres.forEach(g => {
                html += `<a href="#" onclick="filterByGenre('${g}')">${g}</a>`;
            });
            dropdown.innerHTML = html;
        }

        function filterByGenre(genre) {
            const searchInput = document.getElementById('searchInput');
            if(searchInput) {
                searchInput.value = genre;
                searchInput.dispatchEvent(new Event('input'));
                document.getElementById('gallery-title').scrollIntoView({behavior: "smooth"});
            }
        }

        // --- 5. RENDER C√ÅC TRANG ---
        
        function openCartInNewTab() { window.open(`${window.location.pathname}?view=cart`, '_blank'); }
        function goToCartView() { window.location.href = `${window.location.pathname}?view=cart`; }
        function openGameDetail(gameId) { window.open(`${window.location.pathname}?game=${gameId}`, '_blank'); }
        function goToUploadPage() { window.location.href = `${window.location.pathname}?view=upload`; }
        function getQueryParam(param) { const urlParams = new URLSearchParams(window.location.search); return urlParams.get(param); }

        // === 5.1 TRANG CH·ª¶ ===
        function renderHomePage() {
            appContainer.innerHTML = `
                <nav class="navbar">
                    <a class="logo" href="about.html">
                        <i class="fa-solid fa-gamepad"></i> TBN STUDIO
                    </a>
                    <div class="nav-links">
                        <a href="#" class="active">Trang ch·ªß</a>
                        <a href="#gallery-title">Kh√°m ph√°</a>
                        <div class="dropdown">
                            <a href="#">Th·ªÉ lo·∫°i <i class="fa-solid fa-caret-down" style="font-size: 0.8rem;"></i></a>
                            <div class="dropdown-content" id="genreDropdown"></div>
                        </div>
                        <a href="#">C·ªông ƒë·ªìng</a>
                        <a href="#" onclick="goToUploadPage()" style="color:var(--primary-color);font-weight:bold;">
                            <i class="fa-solid fa-upload"></i> ƒêƒÉng t·∫£i game
                        </a>
                    </div>
                    <div class="nav-actions">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="T√¨m game...">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </div>
                        <div class="icon-btn" onclick="openCartInNewTab()" title="Xem gi·ªè h√†ng">
                            <i class="fa-solid fa-cart-shopping"></i>
                            <span class="cart-badge" style="display:none">0</span>
                        </div>
                        <button class="btn-login" onclick="alert('Ch·ª©c nƒÉng ƒëƒÉng nh·∫≠p ƒëang b·∫£o tr√¨!')">ƒêƒÉng nh·∫≠p</button>
                    </div>
                </nav>

                <div class="hero">
                    <h1>TR√ÄN B·ªò NH·ªö</h1>
                    <p>‚ú® H·ªôi ch·ª£ Game Indie - N∆°i √Ω t∆∞·ªüng th√†nh hi·ªán th·ª±c ‚ú®</p>
                </div>

                <div class="container">
                    <h2 id="gallery-title">üî• Game ƒê·ªÅ Xu·∫•t</h2>
                    <div class="game-grid" id="gameGrid"></div>
                </div>
            `;
            
            const gameGrid = document.getElementById('gameGrid');
            const searchInput = document.getElementById('searchInput');

            renderGames(currentGames, gameGrid);
            updateCartBadge();
            renderGenreDropdown(); 
            
            searchInput.addEventListener('input', function(e) {
                const keyword = e.target.value.toLowerCase();
                const filteredGames = currentGames.filter(game => 
                    game.name.toLowerCase().includes(keyword) || 
                    game.genre.toLowerCase().includes(keyword)
                );
                renderGames(filteredGames, gameGrid);
            });
        }

        // === 5.2 TRANG ƒêƒÇNG T·∫¢I GAME (M·ªöI - ƒê·∫¶Y ƒê·ª¶ TH√îNG TIN) ===
        function renderUploadPage() {
            appContainer.innerHTML = `
                <nav class="navbar">
                    <a class="logo" href="${window.location.pathname}">
                        <i class="fa-solid fa-gamepad"></i> TBN STUDIO
                    </a>
                    <div class="nav-links">
                        <a href="${window.location.pathname}">Trang ch·ªß</a>
                        <a href="#" class="active">ƒêƒÉng t·∫£i</a>
                    </div>
                </nav>

                <div class="container">
                    <div class="upload-section">
                        <div class="upload-header">
                            <h1><i class="fa-solid fa-cloud-arrow-up"></i> ƒêƒÉng t·∫£i Game M·ªõi</h1>
                            <p>Chia s·∫ª s·ª± s√°ng t·∫°o c·ªßa b·∫°n v·ªõi c·ªông ƒë·ªìng</p>
                        </div>
                        <form id="uploadFormContent">
                            <div class="form-row">
                                <div class="form-col">
                                    <label>T√™n Game <span class="required-mark">*</span>:</label>
                                    <input type="text" id="gName" required placeholder="Nh·∫≠p t√™n game...">
                                </div>
                                <div class="form-col">
                                    <label>Gi√° (VNƒê) <span class="required-mark">*</span>:</label>
                                    <input type="number" id="gPrice" placeholder="Nh·∫≠p 0 n·∫øu Mi·ªÖn ph√≠">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>S·ªë ng∆∞·ªùi ch∆°i <span class="required-mark">*</span>:</label>
                                    <input type="text" id="gPlayers" required placeholder="VD: Single, Multiplayer...">
                                </div>
                                <div class="form-col">
                                    <label>Th·ªÉ lo·∫°i <span class="required-mark">*</span>:</label>
                                    <input type="text" id="gGenre" required placeholder="VD: Action, RPG...">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Ng∆∞·ªùi ph√°t tri·ªÉn <span class="required-mark">*</span>:</label>
                                    <input type="text" id="gDev" required placeholder="T√™n t√°c gi·∫£...">
                                </div>
                                <div class="form-col">
                                    <label>Th√¥ng tin Bank (ƒê·ªÉ nh·∫≠n ti·ªÅn):</label>
                                    <input type="text" id="gBank" placeholder="STK - Ng√¢n h√†ng - T√™n ch·ªß th·∫ª">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Gi·ªõi thi·ªáu ng·∫Øn (Intro) <span class="required-mark">*</span>:</label>
                                <textarea id="gIntro" rows="3" required placeholder="ƒêo·∫°n gi·ªõi thi·ªáu ng·∫Øn g·ªçn ƒë·ªÉ thu h√∫t ng∆∞·ªùi ch∆°i..."></textarea>
                            </div>

                            <div class="form-group">
                                <label>√ù t∆∞·ªüng v√† C·ªët truy·ªán <span class="required-mark">*</span>:</label>
                                <textarea id="gStory" rows="5" required placeholder="M√¥ t·∫£ chi ti·∫øt c·ªët truy·ªán v√† √Ω t∆∞·ªüng game..."></textarea>
                            </div>

                            <div class="form-group">
                                <label>C√°ch ch∆°i (Gameplay) <span class="required-mark">*</span>:</label>
                                <textarea id="gGameplay" rows="3" required placeholder="H∆∞·ªõng d·∫´n ph√≠m b·∫•m, c√°ch ch∆°i..."></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>ƒêi·ªÅu ki·ªán Th·∫Øng <span class="required-mark">*</span>:</label>
                                    <input type="text" id="gWin" required placeholder="L√†m sao ƒë·ªÉ th·∫Øng?">
                                </div>
                                <div class="form-col">
                                    <label>ƒêi·ªÅu ki·ªán Thua <span class="required-mark">*</span>:</label>
                                    <input type="text" id="gLoss" required placeholder="Khi n√†o th√¨ Game Over?">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Thumbnail (·∫¢nh b√¨a) <span class="required-mark">*</span>:</label>
                                    <input type="file" id="gImage" accept="image/*" required>
                                </div>
                                <div class="form-col">
                                    <label>Link Game (Thay cho upload file):</label>
                                    <input type="text" id="gLink" placeholder="D√°n link Itch.io ho·∫∑c Drive v√†o ƒë√¢y...">
                                </div>
                            </div>

                            <button type="submit" class="btn-play" style="width: 250px; margin: 30px auto 0; display: block; font-size: 1.2rem;">
                                <i class="fa-solid fa-paper-plane"></i> ƒêƒÇNG NGAY
                            </button>
                        </form>
                    </div>
                </div>
            `;
            
            document.getElementById('uploadFormContent').addEventListener('submit', handleGameUpload);
            document.title = "ƒêƒÉng t·∫£i Game | TBN Studio";
        }

        function handleGameUpload(e) {
            e.preventDefault();
            // L·∫•y d·ªØ li·ªáu t·ª´ form
            const name = document.getElementById('gName').value;
            const price = parseInt(document.getElementById('gPrice').value) || 0;
            const players = document.getElementById('gPlayers').value;
            const genre = document.getElementById('gGenre').value;
            const developer = document.getElementById('gDev').value;
            const bank = document.getElementById('gBank').value;
            const intro = document.getElementById('gIntro').value;
            const story = document.getElementById('gStory').value;
            const gameplay = document.getElementById('gGameplay').value;
            const winCondition = document.getElementById('gWin').value;
            const lossCondition = document.getElementById('gLoss').value;
            const linkGame = document.getElementById('gLink').value || "#"; // L·∫•y link game
            const fileInput = document.getElementById('gImage');
            
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const newGame = {
                        id: Date.now(), 
                        name: name, 
                        desc: intro, // D√πng intro l√†m desc ng·∫Øn
                        intro: intro,
                        story: story,
                        gameplay: gameplay,
                        winCondition: winCondition,
                        lossCondition: lossCondition,
                        price: price, 
                        bankInfo: bank,
                        img: e.target.result, 
                        genre: genre, 
                        players: players, 
                        developer: developer, 
                        release: new Date().toLocaleDateString('vi-VN'), // Ng√†y hi·ªán t·∫°i
                        videoUrl: "https://www.youtube.com/embed/n4yK54iF55g?autoplay=1&mute=1", // Video m·∫∑c ƒë·ªãnh
                        downloadUrl: linkGame // L∆∞u link t·∫£i
                    };
                    
                    // Th√™m v√†o m·∫£ng hi·ªán t·∫°i
                    currentGames.unshift(newGame);
                    // L∆ØU V√ÄO LOCAL STORAGE ƒê·ªÇ KH√îNG M·∫§T D·ªÆ LI·ªÜU
                    saveCustomGame(newGame);
                    
                    alert("ƒêƒÉng t·∫£i game th√†nh c√¥ng! D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o tr√¨nh duy·ªát.");
                    window.location.href = window.location.pathname; // Quay v·ªÅ trang ch·ªß
                }
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        // ... [C√ÅC H√ÄM RENDER GAME, CART, DETAIL C≈®] ...
        function renderGames(games, gridElement) {
            gridElement.innerHTML = "";
            const cart = getCart();
            const library = getLibrary();

            if(games.length === 0) {
                gridElement.innerHTML = "<p style='text-align:center; color:#666; grid-column: 1/-1;'>Kh√¥ng t√¨m th·∫•y game n√†o...</p>";
                return;
            }
            games.forEach(game => {
                const isFree = game.price == 0;
                const isOwned = library.includes(game.id);
                const isInCart = cart.includes(game.id);

                let priceDisplay = isFree ? "FREE" : formatter.format(game.price);
                let priceClass = isFree ? "free" : "";
                if (isOwned) { priceDisplay = "OWNED"; priceClass = "owned"; }
                const bankDisplayClass = (!isFree && game.bankInfo) ? "show-bank" : "";

                let buttonHtml = '';
                if (isOwned) {
                      buttonHtml = `
                        <div class="card-actions">
                             <button onclick="openGameDetail(${game.id})" class="btn-secondary" style="flex:1;">Chi ti·∫øt</button>
                             <button onclick="goToCartView()" class="btn-play" style="flex:1; background:var(--success-color); color:white;">ƒê√£ s·ªü h·ªØu</button>
                        </div>`;
                } else if (isFree) {
                      buttonHtml = `
                        <div class="card-actions">
                            <button onclick="openGameDetail(${game.id})" class="btn-play">CH∆†I NGAY</button>
                        </div>`;
                } else {
                    buttonHtml = `
                        <div class="card-actions">
                             <button onclick="openGameDetail(${game.id})" class="btn-play">MUA NGAY</button>
                             <button onclick="addToCart(${game.id})" class="btn-secondary ${isInCart ? 'added' : ''}" title="${isInCart ? 'ƒê√£ trong gi·ªè' : 'Th√™m v√†o gi·ªè'}">
                                <i class="fa-solid ${isInCart ? 'fa-check' : 'fa-cart-plus'}"></i>
                             </button>
                        </div>`;
                }

                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <div class="price-tag ${priceClass}">${priceDisplay}</div>
                    <div class="game-thumb"><img src="${game.img}" alt="${game.name}"></div>
                    <div class="game-info">
                        <h3 class="game-title">${game.name}</h3>
                        <p class="game-desc">${game.desc}</p>
                        <div class="bank-info-display ${bankDisplayClass}">üí≥ CK: ${game.bankInfo}</div>
                        ${buttonHtml}
                    </div>
                `;
                gridElement.appendChild(card);
            });
        }

        // === 5.2 TRANG GI·ªé H√ÄNG (CART PAGE) ===
        function renderCartPage() {
            const cartIds = getCart();
            const libraryIds = getLibrary();
            // C·∫ßn l·∫•y c·∫£ game custom n·∫øu c√≥ trong gi·ªè (load l·∫°i t·ª´ LS ƒë·ªÉ ch·∫Øc ch·∫Øn)
            const allGames = [...initialGames, ...getStoredGames()];
            const cartItemsFull = allGames.filter(g => cartIds.includes(g.id));
            const ownedItemsFull = allGames.filter(g => libraryIds.includes(g.id));

            const total = cartItemsFull.reduce((sum, item) => sum + item.price, 0);

            let cartHtml = '';
            if (cartItemsFull.length === 0) {
                cartHtml = '<div class="empty-cart-msg"><h3>Gi·ªè h√†ng tr·ªëng!</h3><p>H√£y quay l·∫°i trang ch·ªß ƒë·ªÉ t√¨m th√™m game hay nh√©.</p></div>';
            } else {
                cartHtml = `
                    <table class="cart-table">
                        <thead>
                            <tr><th>Game</th><th>Gi√°</th><th>H√†nh ƒë·ªông</th></tr>
                        </thead>
                        <tbody>
                            ${cartItemsFull.map(item => `
                                <tr>
                                    <td style="display:flex; gap:15px; align-items:center;">
                                        <img src="${item.img}" class="cart-item-img">
                                        <strong>${item.name}</strong>
                                    </td>
                                    <td>${formatter.format(item.price)}</td>
                                    <td><button class="btn-remove" onclick="removeFromCart(${item.id})"><i class="fa-solid fa-trash"></i></button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="cart-total">T·ªïng c·ªông: ${formatter.format(total)}</div>
                    <div style="background: #fff3cd; padding: 15px; margin-top: 20px; border-radius: 10px; border: 1px solid #ffeeba;">
                         <strong><i class="fa-solid fa-circle-info"></i> Th√¥ng tin thanh to√°n:</strong><br>
                         C√°c game trong gi·ªè s·∫Ω ƒë∆∞·ª£c thanh to√°n qua chuy·ªÉn kho·∫£n. Vui l√≤ng nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ x√°c nh·∫≠n ƒë√£ chuy·ªÉn kho·∫£n v√† nh·∫≠n game.
                    </div>
                    <button class="btn-checkout" onclick="processCheckout()"><i class="fa-regular fa-credit-card"></i> THANH TO√ÅN NGAY</button>
                `;
            }

            let ownedHtml = '';
            if (ownedItemsFull.length > 0) {
                ownedHtml = `
                    <h2 style="margin-top:50px; border-color: var(--success-color);">Th∆∞ vi·ªán Game ƒë√£ s·ªü h·ªØu</h2>
                    <div class="owned-list">
                        ${ownedItemsFull.map(item => `
                            <div class="owned-item">
                                <img src="${item.img}" style="width:100%; height:100px; object-fit:cover; border-radius:5px; margin-bottom:10px;">
                                <h4>${item.name}</h4>
                                <a href="${window.location.pathname}?game=${item.id}" style="display:block; margin-top:5px; text-decoration:none; color:var(--primary-color); font-weight:bold;">T·∫£i / Ch∆°i</a>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            appContainer.innerHTML = `
                <nav class="navbar">
                    <a class="logo" href="${window.location.pathname}">
                        <i class="fa-solid fa-gamepad"></i> TBN STUDIO
                    </a>
                    <div class="nav-links">
                        <a href="${window.location.pathname}">Trang ch·ªß</a>
                        <a href="#" class="active">Gi·ªè h√†ng</a>
                    </div>
                </nav>
                <div class="container cart-section">
                    <h1><i class="fa-solid fa-cart-shopping"></i> Gi·ªè h√†ng c·ªßa b·∫°n</h1>
                    ${cartHtml}
                    ${ownedHtml}

                    <div style="margin-top: 50px; border-top: 1px solid #ccc; padding-top: 20px; text-align: center;">
                        <p style="color: #666; font-style: italic;">Mu·ªën th·ª≠ nghi·ªám l·∫°i t·ª´ ƒë·∫ßu?</p>
                        <button class="btn-reset" onclick="resetLibrary()">
                            <i class="fa-solid fa-rotate-right"></i> Reset tr·∫°ng th√°i ƒë√£ mua & Game ƒë√£ ƒëƒÉng
                        </button>
                    </div>
                </div>
            `;
            document.title = "Gi·ªè h√†ng | TBN Studio";
        }

        // === 5.3 TRANG CHI TI·∫æT (ƒê√É UPDATE N√öT PLAY) ===
        function renderDetailPage(game) {
            const library = getLibrary();
            const isOwned = library.includes(game.id);
            const isFree = game.price == 0;
            const priceDisplay = isFree ? "FREE" : formatter.format(game.price);

            const storyText = formatGameText(game.story || "ƒêang c·∫≠p nh·∫≠t...");
            const gameplayText = formatGameText(game.gameplay || "S·ª≠ d·ª•ng b√†n ph√≠m v√† chu·ªôt.");
            const winText = formatGameText(game.winCondition || "Ho√†n th√†nh m·ª•c ti√™u.");
            const lossText = formatGameText(game.lossCondition || "H·∫øt m·∫°ng.");
            const introText = formatGameText(game.intro || game.desc);
            
            // X·ª≠ l√Ω link t·∫£i (n·∫øu kh√¥ng c√≥ link th√¨ d√πng #)
            const downloadLink = game.downloadUrl || "#";
            const downloadAction = `window.open('${downloadLink}', '_blank')`;

            let mainButtonHtml = '';
            if (isOwned || isFree) {
                mainButtonHtml = `
                    <button onclick="${downloadAction}" 
                            class="btn-play" style="width: 250px; margin-top: 20px; background: var(--primary-color); color: white; box-shadow: 0 4px 0 var(--primary-dark);">
                        <i class="fa-solid fa-download"></i> T·∫¢I V√Ä CH∆†I NGAY
                    </button>`;
            } else {
                mainButtonHtml = `
                    <button onclick="buyNowFromDetail(${game.id})" 
                            class="btn-play" style="width: 250px; margin-top: 20px; background: var(--accent-pink); color: white; box-shadow: 0 4px 0 #d63031;">
                        <i class="fa-solid fa-cart-plus"></i> MUA V√Ä T·∫¢I (${priceDisplay})
                    </button>
                    <p style="margin-top:10px; font-size:0.9rem; color:#666;">*Game s·∫Ω ƒë∆∞·ª£c th√™m v√†o gi·ªè v√† chuy·ªÉn ƒë·∫øn trang thanh to√°n.</p>`;
            }

            appContainer.innerHTML = `
                <nav class="navbar">
                    <a class="logo" href="${window.location.pathname}">
                        <i class="fa-solid fa-gamepad"></i> TBN STUDIO
                    </a>
                    <div class="nav-links">
                        <a href="${window.location.pathname}">Trang ch·ªß</a>
                        <div class="icon-btn" onclick="openCartInNewTab()">
                             <i class="fa-solid fa-cart-shopping"></i>
                             <span class="cart-badge" style="display:none">0</span>
                        </div>
                    </div>
                </nav>

                <div class="container">
                    <div class="detail-header">
                        <h1>${game.name}</h1>
                        <p>T√°c gi·∫£: ${game.developer}</p>
                        ${mainButtonHtml}
                    </div>

                    <div class="detail-grid">
                        <div class="main-content">
                            <div class="video-player">
                                <iframe src="${game.videoUrl}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                            </div>
                            <div class="intro-box">
                                <h2><i class="fa-regular fa-star" style="color: var(--accent-yellow);"></i> Gi·ªõi thi·ªáu chung</h2>
                                <div class="intro-content">${introText}</div>
                            </div>
                            <div class="story-section">
                                <h2 style="border-left: 8px solid var(--accent-pink);">üìñ C·ªët truy·ªán & √ù t∆∞·ªüng</h2>
                                <div class="story-box">${storyText}</div>
                                <h2 style="margin-top: 30px;">üéÆ H∆∞·ªõng d·∫´n ch∆°i</h2>
                                <div class="gameplay-box">
                                    <strong>C√°ch ƒëi·ªÅu khi·ªÉn:</strong> ${gameplayText}
                                    <ul class="win-loss-list">
                                        <li>
                                            <i class="fa-solid fa-trophy" style="color: gold; font-size: 1.2rem; margin-top: 5px;"></i> 
                                            <div style="flex:1;"><strong>Th·∫Øng:</strong> ${winText}</div>
                                        </li>
                                        <li>
                                            <i class="fa-solid fa-skull" style="color: #ff7675; font-size: 1.2rem; margin-top: 5px;"></i> 
                                            <div style="flex:1;"><strong>Thua:</strong> ${lossText}</div>
                                        </li>
                                    </ul>
                                </div>
                                ${!isFree ? `
                                <div class="purchase-note">
                                    <i class="fa-solid fa-triangle-exclamation" style="font-size: 1.5rem;"></i>
                                    <div>
                                        <strong>L∆∞u √Ω mua game:</strong><br>
                                        Vui l√≤ng chuy·ªÉn kho·∫£n s·ªë ti·ªÅn <strong>${priceDisplay}</strong> ƒë·∫øn STK: <strong>${game.bankInfo}</strong>.
                                    </div>
                                </div>` : ''}
                            </div>
                        </div>

                        <div class="game-specs">
                            <h3>üîç Th√¥ng s·ªë k·ªπ thu·∫≠t</h3>
                            <div class="spec-item"><strong>Th·ªÉ lo·∫°i:</strong> <span>${game.genre}</span></div>
                            <div class="spec-item"><strong>S·ªë ng∆∞·ªùi ch∆°i:</strong> <span>${game.players}</span></div>
                            <div class="spec-item"><strong>Ph√°t tri·ªÉn b·ªüi:</strong> <span>${game.developer}</span></div>
                            <div class="spec-item"><strong>Ng√†y ƒëƒÉng t·∫£i:</strong> <span>${game.release}</span></div>
                            <div class="spec-item"><strong>Gi√° ti·ªÅn:</strong> <span style="color: var(--accent-pink); font-weight:bold;">${priceDisplay}</span></div>
                            <div class="spec-item" style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                                <strong>Tr·∫°ng th√°i:</strong> <br> <span style="color: green; font-weight:bold;">ƒêang ph√°t h√†nh</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.title = `${game.name} - Chi ti·∫øt | TBN Studio`;
            updateCartBadge();
        }

        function buyNowFromDetail(gameId) {
            let cart = getCart();
            if(!cart.includes(gameId)) {
                cart.push(gameId);
                saveCart(cart);
            }
            window.location.href = `${window.location.pathname}?view=cart`;
        }

        // === 6. MAIN INIT ===
        document.addEventListener('DOMContentLoaded', function() {
            const gameId = getQueryParam('game');
            const view = getQueryParam('view');

            if (view === 'cart') {
                renderCartPage();
            } else if (view === 'upload') {
                renderUploadPage();
            } else if (gameId) {
                // L·∫•y game t·ª´ danh s√°ch t·ªïng h·ª£p (g·ªëc + custom)
                const selectedGame = currentGames.find(g => g.id == gameId);
                selectedGame ? renderDetailPage(selectedGame) : (alert("Game kh√¥ng t·ªìn t·∫°i!"), renderHomePage());
            } else {
                renderHomePage();
            }
        });
    </script>
</body>
</html>
